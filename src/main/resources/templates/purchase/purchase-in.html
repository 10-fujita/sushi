<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <div th:replace="~{comlayout/base :: meta}"></div>
    <div th:replace="~{comlayout/base :: styles}"></div>
    <link rel="stylesheet" th:href="@{/css/purchase-in.css}">
    <title>最終確認 | 宅配寿司 寿司処リカレント</title>
</head>

<body>
    <div class="wrapper">
        <div class="inner" id="unique_cart_area">
            <div th:replace="~{comlayout/base :: header}"></div>
            <div th:replace="~{comlayout/base :: nav}"></div>



            <main>
                <h2 class="mn_h201">カート 最終確認</h2>
                <ol class="mn_pankuzu">
                    <li><a th:href="@{/}">TOPページ</a></li>
                    <li><a th:href="@{/cart}">カート</a></li>
                    <li>お届け先を設定</li>
                </ol>

                <div class="confirm_wrap" style="border: 1px solid #ddd; background: #fff; padding: 20px;">

                    <form id="checkout-form"
                          th:object="${orderForm}"
                          action="javascript:void(0);"
                          onsubmit="return false;">

                        <table class="confirm-table" style="margin-bottom: 0; border-bottom: none;">
                            <tr style="background: #f9f9f9;">
                                <th colspan="4"
                                    style="text-align: left; padding: 10px; border-bottom: 2px solid #d32f2f;">
                                    <i class="fas fa-truck"></i> お届け先・日時の確認
                                </th>
                            </tr>
                            <tr>
                                <th style="width: 20%;">お届け日時</th>
                                <td colspan="3">
                                    <span th:text="${#temporals.format(orderForm.deliveryDate, 'yyyy年MM月dd日')}"></span>
                                    <span th:text="*{deliveryTimeSlot}"></span> 頃
                                </td>
                            </tr>
                            <tr>
                                <th>お届け先</th>
                                <td colspan="3">
                                    〒<span th:text="*{postalCode}"></span><br>
                                    <span th:text="*{prefecture}"></span> <span th:text="*{city}"></span> <span
                                        th:text="*{addressLine1}"></span>
                                    <span th:if="*{addressLine2 != null}" th:text="*{addressLine2}"></span><br>
                                    <span th:text="*{recipientName}"></span> 様 （TEL: <span
                                        th:text="*{phoneNumber}"></span>）
                                </td>
                            </tr>

                            <tr style="background: #f9f9f9;">
                                <th colspan="4"
                                    style="text-align: left; padding: 10px; border-top: 1px solid #ddd; border-bottom: 2px solid #d32f2f;">
                                    <i class="fas fa-shopping-cart"></i> ご注文商品の確認
                                </th>
                            </tr>
                            <tr style="background: #eee;">
                                <th style="width: 50%;">商品名</th>
                                <th style="width: 15%;">単価</th>
                                <th style="width: 10%;">数量</th>
                                <th style="width: 25%;">小計</th>
                            </tr>

                            <tr th:each="item : ${cartItems}">
                                <td th:text="${item.product.name}">商品名</td>
                                <td class="price" style="text-align: right;"
                                    th:text="${#numbers.formatInteger(item.unitPrice, 1, 'COMMA')} + '円'"></td>
                                <td style="text-align: center;" th:text="${item.quantity}"></td>
                                <td class="price" style="text-align: right; font-weight: bold;"
                                    th:text="${#numbers.formatInteger(item.unitPrice * item.quantity, 1, 'COMMA')} + '円'">
                                </td>
                            </tr>

                            <tr class="total-row" style="background: #fff9f9;">
                                <td colspan="3"
                                    style="text-align: right; font-weight: bold; font-size: 1.2em; padding: 15px;">
                                    合計金額（税込）</td>
                                <td class="total-price"
                                    style="text-align: right; color: #d32f2f; font-size: 1.5em; font-weight: bold; padding: 15px;">
                                    <span th:text="${#numbers.formatInteger(totalPrice, 1, 'COMMA')}">0</span>円
                                </td>
                            </tr>
                        </table>

                        <input type="hidden" th:field="*{recipientName}">
                        <input type="hidden" th:field="*{postalCode}">
                        <input type="hidden" th:field="*{prefecture}">
                        <input type="hidden" th:field="*{city}">
                        <input type="hidden" th:field="*{addressLine1}">
                        <input type="hidden" th:field="*{addressLine2}">
                        <input type="hidden" th:field="*{phoneNumber}">
						<input type="hidden"
						       name="deliveryDate"
						       th:value="${orderForm.deliveryDate}">

						<input type="hidden"
						       name="deliveryTimeSlot"
						       th:value="${orderForm.deliveryTimeSlot}">

                        <div style="text-align: center; margin-top: 30px;">
                            <button type="button" id="checkout-btn"
                                style="background-color: #d32f2f; color: white; padding: 15px 80px; border: none; border-radius: 5px; font-size: 20px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #a02323;">
                                この内容で注文を確定する
                            </button>
                        </div>
                    </form>
                </div>
            </main>
        </div>

        <div th:replace="~{comlayout/base :: footer}"></div>
    </div>
    <!--jquery-->
      <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script th:src="@{/js/stripe.js}"></script>
</body>

</html>