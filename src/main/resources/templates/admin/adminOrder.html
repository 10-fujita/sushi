<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
    <div th:replace="~{comlayout/base :: meta}"></div>
    <div th:replace="~{comlayout/base :: styles}"></div>
    <link rel="stylesheet" th:href="@{/css/admin-order.css}">


    <title>注文履歴管理 | 寿司処リカレント</title>
</head>

<body>
    <div class="wrapper">
        <div class="inner">
            <div th:replace="~{comlayout/base :: header}"></div>

            <main>
                <div class="admin-form-wrap">
                    <h1>注文履歴一覧</h1>
                    <div class="filter-controls" style="margin-bottom: 20px; display: flex; gap: 10px;">
                        <button type="button" class="filter-btn active" onclick="filterOrders('all')">すべて</button>
                        <button type="button" class="filter-btn" onclick="filterOrders('ORDERED')">未配達</button>
                        <button type="button" class="filter-btn" onclick="filterOrders('COMPLETED')">配達済み</button>
                    </div>
                    <div th:if="${#lists.isEmpty(orderList)}">
                        <p>注文履歴はありません。</p>
                    </div>

                    <form th:action="@{/admin/checkOrder}" method="post" th:if="${!#lists.isEmpty(orderList)}">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>選択</th>
                                    <th>注文日時</th>
                                    <th>ユーザー情報</th>
                                    <th>注文番号</th>
                                    <th>注文内容</th>
                                    <th>届け先住所</th>
                                    <th>届け希望時間</th>
                                    <th>合計金額</th>
                                    <th>ステータス</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="order : ${orderList}">
                                    <td style="text-align: center;">
                                        <input type="checkbox" name="orderIds" th:value="${order.id}">
                                    </td>
                                    <td th:text="${#temporals.format(order.orderDatetime, 'yyyy/MM/dd HH:mm')}"></td>
                                    <td>
                                        ID: <span th:text="${order.user.id}"></span><br>
                                        <span th:text="${order.shippingRecipientName}"></span> 様
                                    </td>
                                    <td th:text="${order.orderNumber}"></td>
                                    <td>
                                        <span th:each="item, iterStat : ${order.items}">
                                            <span th:text="${item.productName} + '×' + ${item.quantity}"></span>
                                            <span th:if="${!iterStat.last}">、</span>
                                        </span>
                                    </td>
                                    <td>
                                        <small th:text="'〒' + ${order.shippingPostalCode}"></small><br>
                                        <span
                                            th:text="${order.shippingPrefecture} + ${order.shippingCity} + ${order.shippingAddressLine1}"></span><br>
                                        <span th:if="${order.shippingAddressLine2 != null}"
                                            th:text="${order.shippingAddressLine2}"></span>
                                        <div style="font-size: 0.8em; color: #777;"
                                            th:text="'TEL: ' + ${order.shippingPhoneNumber}"></div>
                                    </td>
                                    <td>
                                        <div th:if="${order.deliveryDate != null}">
                                            <strong
                                                th:text="${#temporals.format(order.deliveryDate, 'yyyy/MM/dd(E)')}"></strong>
                                        </div>
                                        <div th:unless="${order.deliveryDate != null}" style="color: #999;">指定なし</div>

                                        <div th:if="${order.deliveryTimeSlot != null and order.deliveryTimeSlot != ''}"
                                            th:text="${order.deliveryTimeSlot}"
                                            style="font-size: 0.9em; margin-top: 4px;">
                                        </div>
                                    </td>

                                    <td th:text="${#numbers.formatInteger(order.totalAmount, 1, 'COMMA')} + '円'"></td>
                                    <td th:text="${order.status}" class="status-cell"></td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="form-actions">
                            <button type="submit" class="btn-submit">選択した注文を完了する</button>
                            <a class="btn-cancel" th:href="@{/admin/adminPage}">戻る</a>
                        </div>
                    </form>
                </div>
            </main>
            <div th:replace="~{comlayout/base :: footer}"></div>
        </div>
    </div>
    <!--jquery-->
      <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
     <!--original-->
      <script th:src="@{/js/ybbg.js}"></script>
</body>


</html>